#!/usr/bin/env bqn
âŸ¨Min, Max, StartsWith, Switch, TokenizeâŸ© â† â€¢Import "../lib.bqn"
Decode â† {
    l â† Tokenize ğ•©
    Switch âŸ¨âŠ‘l
        "value" â‹„  { ğ•¤â‹„ 'v'â€¿(1â†“l)}
        "bot"   â‹„  { ğ•¤â‹„ 'b'â€¿(1â†“l)}
    âŸ©
}
# Part 1: #####################################
Link â† {
    âŸ¨'b', lâŸ© F n: {
        âŸ¨min, maxâŸ© â† âŸ¨â€¢BQN 5âŠ‘l, â€¢BQN 10âŠ‘lâŸ©
        { (4âŠ‘l) StartsWith "out" ? min â†© Â¯1Ã—1+min;@ }
        { (9âŠ‘l) StartsWith "out" ? max â†© Â¯1Ã—1+max;@ }
        minâ€¿maxâŒ¾((â€¢BQN âŠ‘l)âŠ¸âŠ‘) n
    };
    i F x: x
}
SetToken â† {
    âŸ¨'v', lâŸ© F pn: {
        âŸ¨val, idxâŸ© â† âŸ¨â€¢BQN 0âŠ‘l, â€¢BQN 4âŠ‘lâŸ©
        fst â† 1âŠ‘idxâŠ‘pn
        {
            fst â‰  Â¯âˆ ? valË™âŒ¾(1âŠ¸âŠ‘idxâŠ¸âŠ‘) pn;
            âŸ¨mi, maâŸ© â† âŸ¨fst Min val, fst Max valâŸ©
            (1â€¿miâ€¿ma)Ë™âŒ¾(idxâŠ¸âŠ‘) pn
        }
    };
    i F x: x
}
Unpropagated â† { pn F idx:
    record â† idxâŠ‘pn
    (0âŠ‘record = 0) âˆ§ (1âŠ‘record â‰  Â¯âˆ) âˆ§ (2âŠ‘record â‰  Â¯âˆ)
}
Propagate â† {
    len â† â‰ petri
    unp â† (petriâŠ¸Unpropagated)Â¨ â†•len
    target â† unp âŠ’ <1
    {
        target < len ? @; @
    }
    ğ•©
}

example â† âŸ¨
    "value 5 goes to bot 2"
    "bot 2 gives low to bot 1 and high to bot 0"
    "value 3 goes to bot 1"
    "bot 1 gives low to output 1 and high to bot 0"
    "bot 0 gives low to output 2 and high to output 0"
    "value 2 goes to bot 2"
    âŸ©
â€¢Show â‰âŸœ(DecodeÂ¨) example
data â† â¥Š â€¢FLines "../data/2016/input-day10.txt"
â€¢Show â‰âŸœ(DecodeÂ¨) 2â†‘ data
insts â† âŒ½ DecodeÂ¨ data
network â† (Â¯âˆâ€¿Â¯âˆË™Â¨ â†•220) LinkÂ´ insts
petri â† (0â€¿Â¯âˆâ€¿Â¯âˆË™Â¨ â†•220) SetTokenÂ´ insts
â€¢Show network
â€¢Show petri
# â€¢Show +Â´'#'=Â¨ â¥Š EvalÂ´âŒ½ DecodeÂ¨ data

# Part 2: #####################################
