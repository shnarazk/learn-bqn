#!/usr/bin/env bqn
âŸ¨For, ParseInts, StartsWith, Switch, TokenizeâŸ© â† â€¢Import "../lib.bqn"
Decode â† {
    x â† ğ•©
    l â† Tokenize ğ•©
    Switch âŸ¨âŠ‘l
        "value" â‹„  { ğ•¤â‹„ 'v'â€¿(Tokenize x)}
        "bot"   â‹„  { ğ•¤â‹„ 'b'â€¿(Tokenize x)}
    âŸ©
}
# Part 1: #####################################
status â† âˆâ€¿Â¯âˆË™Â¨ â†•220
status â†© 3â€¿Â¯âˆâŒ¾(2âŠ¸âŠ‘) status
status â†© 2â€¿Â¯âˆâŒ¾(3âŠ¸âŠ‘) status
trace â† âŸ¨âŸ©Ë™Â¨ â†•220
Dispatch â† {
 âŸ¨'v', lâŸ© F âŸ¨status, traceâŸ©:
    â€¢Out âˆ¾ (1âŠ‘l)â€¿" => "â€¿(5âŠ‘l)
    index â† â€¢BQN 5âŠ‘l
    val â† â€¢BQN 1âŠ‘l
    min â† 0âŠ‘indexâŠ‘ status
    max â† 1âŠ‘indexâŠ‘ status
    "assumption error" ! (max = Â¯âˆ)
    {
        min = âˆ ? min â†© val;
        min < val ? max â†© val;
        max â†© min â‹„ min â†© val
    }
    âŸ¨minâ€¿maxâŒ¾(indexâŠ¸âŠ‘) status, âŸ¨indexâŸ©Ë™âŒ¾(valâŠ¸âŠ‘) traceâŸ©
    ;
 âŸ¨'b', lâŸ© F âŸ¨status, traceâŸ©:
    â€¢Out âˆ¾ (1âŠ‘l)â€¿" "â€¿(3âŠ‘l)â€¿" -> "â€¿(6âŠ‘l)â€¿" and "â€¿(8âŠ‘l)â€¿" -> "â€¿(11âŠ‘l)
    index â† â€¢BQN 1âŠ‘l
    li â† 0âŠ‘indexâŠ‘ status
    low â† â€¢Repr li
    hi â† 1âŠ‘indexâŠ‘ status
    high â† â€¢Repr hi
    {
        (5âŠ‘l) StartsWith "bot" ?
            "assumption error" ! (low â‰  Â¯âˆ)
            status â†© âŸ¨'v', "value"â€¿lowâ€¿"goes"â€¿"to"â€¿"bot"â€¿(6âŠ‘l)âŸ© Dispatch status
            â€¢Show li
            trace â†© (indexâŠ¸âˆ¾)âŒ¾(liâŠ¸âŠ‘) trace
            ;
        @
    }
    {
        (10âŠ‘l) StartsWith "bot" ?
            "assumption error" ! (high â‰  Â¯âˆ)
            status â†© âŸ¨'v', "value"â€¿highâ€¿"goes"â€¿"to"â€¿"bot"â€¿(11âŠ‘l)âŸ© Dispatch status
            trace â†© (indexâŠ¸âˆ¾)âŒ¾(hiâŠ¸âŠ‘) trace
            ;
        @
    }
    âŸ¨status, traceâŸ©
    ;
 instruction F x: x
}
Assign â† { âŸ¨'v', lâŸ© F âŸ¨status, traceâŸ©:
    â€¢Out âˆ¾ (1âŠ‘l)â€¿" => "â€¿(5âŠ‘l)
    index â† â€¢BQN 5âŠ‘l
    val â† â€¢BQN 1âŠ‘l
    min â† 0âŠ‘indexâŠ‘ status
    max â† 1âŠ‘indexâŠ‘ status
    "assumption error" ! (max = Â¯âˆ)
    {
        min = âˆ ? min â†© val;
        min < val ? max â†© val;
        max â†© min â‹„ min â†© val
    }
    âŸ¨minâ€¿maxâŒ¾(indexâŠ¸âŠ‘) status, âŸ¨indexâŸ©Ë™âŒ¾(valâŠ¸âŠ‘) traceâŸ©
    ;
 instruction F x: x
}
Distibute â† { âŸ¨'b', lâŸ© F âŸ¨status, traceâŸ©:
    â€¢Out âˆ¾ (1âŠ‘l)â€¿" "â€¿(3âŠ‘l)â€¿" -> "â€¿(6âŠ‘l)â€¿" and "â€¿(8âŠ‘l)â€¿" -> "â€¿(11âŠ‘l)
    index â† â€¢BQN 1âŠ‘l
    li â† 0âŠ‘indexâŠ‘ status
    low â† â€¢Repr li
    hi â† 1âŠ‘indexâŠ‘ status
    high â† â€¢Repr hi
    {
        (5âŠ‘l) StartsWith "bot" ?
            "assumption error" ! (low â‰  Â¯âˆ)
            status â†© âŸ¨'v', "value"â€¿lowâ€¿"goes"â€¿"to"â€¿"bot"â€¿(6âŠ‘l)âŸ© Dispatch status
            â€¢Show li
            trace â†© (indexâŠ¸âˆ¾)âŒ¾(liâŠ¸âŠ‘) trace
            ;
        @
    }
    {
        (10âŠ‘l) StartsWith "bot" ?
            "assumption error" ! (high â‰  Â¯âˆ)
            status â†© âŸ¨'v', "value"â€¿highâ€¿"goes"â€¿"to"â€¿"bot"â€¿(11âŠ‘l)âŸ© Dispatch status
            trace â†© (indexâŠ¸âˆ¾)âŒ¾(hiâŠ¸âŠ‘) trace
            ;
        @
    }
    âŸ¨status, traceâŸ©
    ;
 instruction F x: x
}
example â† âŸ¨
    "value 5 goes to bot 2"
    "bot 2 gives low to bot 1 and high to bot 0"
    "value 3 goes to bot 1"
    "bot 1 gives low to output 1 and high to bot 0"
    "bot 0 gives low to output 2 and high to output 0"
    "value 2 goes to bot 2"
    âŸ©
â€¢Show â‰âŸœ(DecodeÂ¨) example
data â† â¥Š â€¢FLines "../data/2016/input-day10.txt"
â€¢Show â‰âŸœ(DecodeÂ¨) 2â†‘ data
insts â† âŒ½ DecodeÂ¨ data
st1 â† âŸ¨status, traceâŸ© AssignÂ´ insts
â€¢Show st1 DistibuteÂ´ insts
# â€¢Show +Â´'#'=Â¨ â¥Š EvalÂ´âŒ½ DecodeÂ¨ data

# Part 2: #####################################
